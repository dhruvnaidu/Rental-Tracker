rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Match the specific path structure we use in App.js
    match /artifacts/{appId}/users/{userId}/{document=**} {
      
      // 1. AUTHENTICATION: User must be logged in
      // 2. AUTHORIZATION: User can only access their own data path
      // 3. VALIDATION: If 'rentAmount' or 'amount' is provided, it MUST be a number
      allow read, write: if request.auth != null 
                        && request.auth.uid == userId
                        && (
                          (!('rentAmount' in request.resource.data) || request.resource.data.rentAmount is number)
                          &&
                          (!('amount' in request.resource.data) || request.resource.data.amount is number)
                        );
    }
  }
}